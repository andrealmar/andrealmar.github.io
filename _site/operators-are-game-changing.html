<!DOCTYPE html>
<html>

<head>
	<!-- Meta -->
	<meta charset="UTF-8"/>
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
	<meta name="generator" content="Jekyll">

	<title>Operators and paradigm shift</title>
  <meta name="description" content="Operators and paradigm shift">

	<!-- CSS & fonts -->
	<link rel="stylesheet" href="/css/main.css">

	<!-- RSS -->
	<link href="/atom.xml" type="application/atom+xml" rel="alternate" title="ATOM Feed" />

  <!-- Favicon -->
  <link rel="shortcut icon" type="image/png" href="img/favicon.png">

</head>


<body>
	<div id="wrap">

	  <!-- Navigation -->
	  <nav id="nav">
	<div id="nav-list">
		<a href="//">Home</a>

		<!-- Nav pages -->
	  
	    
	  
	    
	      <a href="/about" title="About">About</a>
	    
	  
	    
	  
	    
	  
	    
	  
	    
	  
	    
	  
	    
	  
    
    <!-- Nav links -->
	  <a href="#">Reading</a>


	</div>
  
  <!-- Nav footer -->
	
	  <footer>
	
	<span>version 1.0.0</span>

</footer>
	

</nav>


    <!-- Icon menu -->
	  <a id="nav-menu">
	      <div id="menu"></div>
	  </a>

      <!-- Header -->
      
        <header id="header" class="parent justify-spaceBetween">
  <div class="inner w100 relative">
    <span class="f-left">
      <a href="//">
        <h1>
          <span>andre</span>almar
        </h1>
      </a>
    </span>
    <span id="nav-links" class="absolute right bottom">
      <!-- Nav pages -->
	    
	      
	    
	      
	        <a href="/about" title="About">About</a>
	      
	    
	      
	    
	      
	    
	      
	    
	      
	    
	      
	    
	      
	    

      <!-- Nav links -->
	    <a href="#">Reading</a>


    </span>
  </div>
</header>

      

    <!-- Main content -->
	  <div id="container">

	  <main>

	    <article id="post-page">
	<h1>Operators and paradigm shift</h1>
	<time datetime="2018-09-15T00:00:00-03:00" class="by-line">15 Sep 2018</time>
	<div class="content">

		<p>https://coreos.com/blog/introducing-operators.html
https://itnext.io/wth-is-a-operator-lifecycle-manager-873cf1661b04</p>

<p><img src="/img/foo_fighters_generator.png" alt="" title="Foo FIghters - Generator (single)" /></p>

<ul>
  <li>I believe we’re in the middle of a huge paradigm shift, in which Kubernetes and Operators will play a fundamental, new role.</li>
  <li>Kubernetes is not only a container Orchestrator, it is an Application Platform</li>
  <li>it’s not like infrastructure automation, service orchestration and automated recovery are anything new. The main point, though, is they were in different domains. This is exactly the reason why Operators matter: in Kubernetes world, everything belongs together</li>
  <li>Infrastructure == Kubernetes</li>
  <li>Service == Your Service</li>
  <li>Operational Intelligence == Operator</li>
  <li>What really matters, though, is that as long as our infrastructure is provided with the needed warranties, we can start building on top of it.</li>
  <li>Infrastructure Providers and Cloud Vendors are no longer competitors: they’re becoming customers/distributors.</li>
  <li>In a world where everybody is enabled to distribute the same piece of software, the difference stands in how you do it.</li>
  <li>The scenario today is: For software companies, building and maintaining cloud-native applications today is not a simple task - they must address significant complexities during the initial build and provide maintenance across siloed cloud footprints.</li>
  <li>Using Operators you can write software that runs across any cloud where Kubernetes runs.</li>
  <li>A Kubernetes application is an application that is both deployed on Kubernetes and managed using the Kubernetes APIs and kubectl tooling. Kubernetes Operators simplify application development for Kubernetes platforms by abstracting away complexities and coding human operational knowledge into applications, creating services that can function without human intervention.</li>
  <li>You write a software, package and make it available within the Kubernetes platform without knowing the details of the Kubernetes APIs.</li>
  <li>An Operator is a Kubernetes pattern that is extending the Kubernetes control plane with a custom Controller and Custom Resource Definitions that add additional operational knowledge of an application.</li>
  <li>The etcd Operator extends Kubernetes to handle operations such as backups and resizing etcd clusters. These are the type of tasks that normally have humans following written playbooks to fix deployments when they get paged at 4AM. The CoreOS philosophy was to automate solutions to eliminate operational toil for the future. If you’ve resized the cluster once, you’re going to need to resize it a million times. Why not teach the computer to do it for you?</li>
  <li>
    <h2 id="eliminating-toil-httpslandinggooglecomsrebookchapterseliminating-toilhtml">Eliminating Toil: https://landing.google.com/sre/book/chapters/eliminating-toil.html</h2>
  </li>
</ul>

<p>Não…eu não vou escrever neste post sobre a ótima música do Foo Fighters, embora recomendo que você a escute =P. Estamos aqui para falar de uma função bastante legal na nossa linguagem de programação preferida: Os famosos Generators.</p>

<p>Em termo simples os <code class="highlighter-rouge">Generators</code> são funções que permitem a você declarar uma função que se comporta como um iterador, ou seja, que pode ser usado dentro de um loop for.</p>

<p>Simplificando mais ainda: Generators são uma forma simples de criarmos iteradores. Ele irá retornar um objeto (iterador) para que possamos iterar sobre este objeto (um valor de cada vez).</p>

<p>É muito simples criar uma função Generator, mas existem algumas peculiaridades. Por exemplo, nós usamos a declaração <code class="highlighter-rouge">yield</code> ao invés de <code class="highlighter-rouge">return</code>. Se a função contém ao menos uma declaração <code class="highlighter-rouge">yield</code> então ela se torna uma função Generator.</p>

<p>Um exemplo bem simples. Abra o seu interpretador Python e digite a função abaixo:</p>

<figure class="highlight"><pre><code class="language-go" data-lang="go"><span class="n">def</span><span class="x"> </span><span class="n">generator</span><span class="p">()</span><span class="o">:</span><span class="x">
    </span><span class="n">n</span><span class="x"> </span><span class="o">=</span><span class="x"> </span><span class="m">1</span><span class="x">
    </span><span class="nb">print</span><span class="p">(</span><span class="s">"Essa  uma função Generator"</span><span class="p">)</span><span class="x">
    </span><span class="n">yield</span><span class="x"> </span><span class="n">n</span><span class="x">

    </span><span class="n">n</span><span class="x"> </span><span class="o">+=</span><span class="x"> </span><span class="m">1</span><span class="x">
    </span><span class="n">yield</span><span class="x"> </span><span class="n">n</span><span class="x">

    </span><span class="n">n</span><span class="x"> </span><span class="o">+=</span><span class="x"> </span><span class="m">1</span><span class="x">
    </span><span class="n">yield</span><span class="x"> </span><span class="n">n</span></code></pre></figure>

<p>Vamos agora, executar a função no interpretador Python:</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell"><span class="o">&gt;&gt;&gt;</span> <span class="c"># Retorna um objeto mas não executa a função imediatamente.</span>
<span class="o">&gt;&gt;&gt;</span> a <span class="o">=</span> generator<span class="o">()</span>

<span class="o">&gt;&gt;&gt;</span> <span class="c"># Podemos iterar sobre os items usando next().</span>
<span class="o">&gt;&gt;&gt;</span> next<span class="o">(</span>a<span class="o">)</span>

Essa  uma função Generator
1
<span class="o">&gt;&gt;&gt;</span> <span class="c"># Assim que a função executa o yield, ela é pausada e o controle da execução é transferido para quem a chamou.</span>

<span class="o">&gt;&gt;&gt;</span> <span class="c"># Variáveis locais e os seus estados são "lembradas" durante as sucessivas chamadas à função.</span>
<span class="o">&gt;&gt;&gt;</span> next<span class="o">(</span>a<span class="o">)</span>
2
<span class="o">&gt;&gt;&gt;</span> next<span class="o">(</span>a<span class="o">)</span>
3

<span class="o">&gt;&gt;&gt;</span> <span class="c"># Quando a função termina, a exceção StopIteration é levantada automaticamente.</span>
<span class="o">&gt;&gt;&gt;</span> next<span class="o">(</span>a<span class="o">)</span>
Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
...
StopIteration
<span class="o">&gt;&gt;&gt;</span> next<span class="o">(</span>a<span class="o">)</span>
Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
...
StopIteration</code></pre></figure>

<p>Interessante notar que o valor da variável a no exemplo acima é lembrada durante cada chamada do método next(). Nós declaramos 3 yields, então o valor da variável a será lembrado por 3 vezes. Quando tentamos chamar next(a) pela 4a vez, veja o que acontece:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="o">&gt;&gt;&gt;</span> <span class="c"># Quando a função termina, a exceção StopIteration é levantada automaticamente.</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">next</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">):</span>
<span class="o">...</span>
<span class="nb">StopIteration</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">next</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">):</span>
<span class="o">...</span>
<span class="nb">StopIteration</span></code></pre></figure>

<p>Uma exceção <code class="highlighter-rouge">StopIteration</code> é lançada, alertando que a iteração acabou. Ou seja, as variáveis locais NÃO são destruídas quando usamos o <code class="highlighter-rouge">yield</code>. O objeto Generator só pode ser iterado uma única vez. Se quisermos restartar o processo nós precisaremos criar um outro objeto Generator, por exemplo <code class="highlighter-rouge">b = generator()</code>.</p>

<p>Também podemos utilizar Generators dentro de um laço for diretamente. Isso porque o laço for também utiliza a função <code class="highlighter-rouge">next()</code> para iterar e automaticamente encerra a iteração quando a exceção <code class="highlighter-rouge">StopIteration</code> é lançada.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="o">&gt;&gt;&gt;</span> <span class="k">for </span>item <span class="k">in </span>generator<span class="o">()</span>:
...     print<span class="o">(</span>item<span class="o">)</span>
...
Essa é uma função Generator
1
2
3
<span class="o">&gt;&gt;</span></code></pre></figure>

<h3 id="generators-expressions">Generators Expressions</h3>

<p>As <code class="highlighter-rouge">Generators Expressions</code> facilitam à criação de Generators. Assim como uma função lambda cria uma função anônima, uma <code class="highlighter-rouge">Generator Expression</code> cria uma função Generator anônima. A sintaxe é bem parecida com as famosas <code class="highlighter-rouge">List Comprehensions</code> com o pequeno detalhe de que os colchetes <code class="highlighter-rouge">[ ]</code> são subsituídos pelos parênteses <code class="highlighter-rouge">()</code>.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">list_comprehension</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">]</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">generator_expression</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">)</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="o">&gt;&gt;&gt;</span> <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">x</span>
<span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">generator_expression</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">x</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">generator_expression</span>
<span class="o">&lt;</span><span class="n">generator</span> <span class="nb">object</span> <span class="o">&lt;</span><span class="n">genexpr</span><span class="o">&gt;</span> <span class="n">at</span> <span class="mh">0x101812af0</span><span class="o">&gt;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">list_comprehension</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">x</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">list_comprehension</span>
<span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span></code></pre></figure>

<p>Note no exemplo acima que a <code class="highlighter-rouge">List Comprehension</code> nos retorna a lista em si mas a <code class="highlighter-rouge">Generator Expression</code> nos retorna o objeto gerado: <code class="highlighter-rouge">&lt;generator object &lt;genexpr&gt; at 0x101812af0&gt;</code>.</p>

<p>A outra vantagem é que enquanto a <code class="highlighter-rouge">List Comprehension</code> gera a lista inteira, a <code class="highlighter-rouge">Generator Expression</code> gera um item de cada vez. Isso também é chamado de <em>lazy ou on demand generation of values</em>. E por consequência de ser lazy (preguiçosa), a <code class="highlighter-rouge">Generator Expression</code> consome bem menos memória sendo mais eficiente do que uma <code class="highlighter-rouge">List Comprehension</code>.</p>

<p>Espero que tenham gostado dessa explicação a respeito dos Generators.</p>

<p>See ya !!!</p>


	</div>
</article>


	  </main>

		  <!-- Pagination links -->
      

	  </div>

	    <!-- Footer -->
	    <footer><span>@2018 - andrealmar.com</span></footer>


	    <!-- Script -->
      <script src="/js/main.js"></script>	


	</div>
</body>
</html>
