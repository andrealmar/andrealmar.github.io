<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>Containerizing your applications with Docker - Part 2 &middot; André Almar</title>

  
  <link rel="stylesheet" href="http://andrealmar.com/css/poole.css">
  <link rel="stylesheet" href="http://andrealmar.com/css/hyde.css">
  <link rel="stylesheet" href="http://andrealmar.com/css/poole-overrides.css">
  <link rel="stylesheet" href="http://andrealmar.com/css/hyde-overrides.css">
  <link rel="stylesheet" href="http://andrealmar.com/css/hyde-x.css">
  <link rel="stylesheet" href="http://andrealmar.com/css/highlight/sunburst.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700">
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://andrealmar.com/touch-icon-144-precomposed.png">
  <link href="http://andrealmar.com/favicon.png" rel="icon">

  
  
  
  

  <meta name="description" content="I am a software developer trying to change the world one line-of-code at a time.">
  <meta name="keywords" content="andre,almar,andre almar,developer,engineer,web application,python,golang,javascript,html,docker,devops,entrepreneurship, web development">
  
</head>
<body class="theme-base-4b">
<div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      
      <h1>André Almar</h1>
      <p class="lead">Trying to change the world one line-of-code at a time.</p>
    </div>

    <ul class="sidebar-nav">
      <li class="sidebar-nav-item"><a href="http://andrealmar.com/">Home</a></li>
      <li class="sidebar-nav-item"><a href="http://andrealmar.com/about">About</a></li>
      <li class="sidebar-nav-item"><a href="http://andrealmar.com/talks">Talks</a></li>
      <li class="sidebar-nav-item"><a href="http://andrealmar.com/projects">Projects</a></li>
      <li class="sidebar-nav-item"><a href="mailto:andre@pydevv.com?Subject=Contact%20via%20website">Contact</a></li>
      <li class="sidebar-nav-item"><a href="http://andrealmar.com/download/andre-araujo-cv.pdf">Resume</a></li>


      
    </ul>

    <ul class="sidebar-nav">
      <li class="sidebar-nav-item">
      <a href="https://github.com/andrealmar"><i class="fa fa-github-square fa-3x"></i></a>
      
      
      
      <a href="https://plus.google.com/&#43;AndreAraujo04"><i class="fa fa-google-plus-square fa-3x"></i></a>
      <a href="https://facebook.com/andrealmar"><i class="fa fa-facebook-square fa-3x"></i></a>
      <a href="https://twitter.com/andre_almar"><i class="fa fa-twitter-square fa-3x"></i></a>
      
      
      </li>
    </ul>

    

    <p>&copy; 2016 Andre Almar<br/>
    All Rights Reserved <br />Creative Commons License<a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/"><img alt="Contract Creative Commons" style="border-width:0" src="http://i.creativecommons.org/l/by-sa/3.0/80x15.png" /></a></p>
  </div>
</div>


<div class="content container">
  <div class="post">
    <h1>Containerizing your applications with Docker - Part 2</h1>
    <span class="post-date">Apr 4, 2016 &middot; 5 minute read &middot; <a href="http://andrealmar.com/2016/04/containerizing-your-applications-with-docker-part-ii/#disqus_thread">Comments</a>
    
    <br/>
    <a class="label" href="http://andrealmar.com/categories/python">python</a><a class="label" href="http://andrealmar.com/categories/docker">docker</a><a class="label" href="http://andrealmar.com/categories/devops">devops</a><a class="label" href="http://andrealmar.com/categories/postgresql">postgresql</a>
    </span>
    

<p>Ready for Part 2? If you don&rsquo;t read, please read <a href="http://andrealmar.com/2016/04/containerizing-your-applications-with-docker-part-i/">Part 1</a> which will give you a brief introduction in some concepts that you will need to grasp before get your hands dirty with Docker. Ok? So&hellip;.Let&rsquo;s get started.</p>

<p><br/>
<img src="/images/docker.jpg"></p>

<h2 id="docker-image">Docker Image</h2>

<blockquote>
<p>Docker images are the basis of containers. It&rsquo;s an encapsulated environment ready to be replicated wherever you want. Each time you’ve used <em>docker run</em> you told it which image you wanted.</p>
</blockquote>

<p>In the previous section of our tutorial you used a Docker image that already exists, the <em>library/hello-world</em> image.</p>

<p>Remember that we did:</p>

<pre><code>docker run hello-world
</code></pre>

<p>And then we saw this output:</p>

<pre><code>Unable to find image 'hello-world:latest' locally
latest: Pulling from library/hello-world
</code></pre>

<p>Docker stores downloaded images on the Docker host. If an image isn’t already present on the host then it’ll be downloaded from a registry: by default the <a href="https://registry.hub.docker.com/">Docker Hub Registry</a>.</p>

<p>If you want to see a list of images that you have locally you can do it by using the command:</p>

<pre><code>docker images
</code></pre>

<p>In my case it shows those three images that I have locally:</p>

<pre><code class="language-shell">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE
kartoza/postgis     latest              c209e16e71f7        5 days ago          496.1 MB
ubuntu              latest              97434d46f197        2 weeks ago         188 MB
hello-world         latest              690ed74de00f        5 months ago        960 B
</code></pre>

<p>Docker also allows us to create our own images using a definition file called Dockerfile. With Dockerfile we can specify instructions and commands that tell Docker how to build our image. It&rsquo;s literally a recipe.</p>

<p>Let&rsquo;s create our image and in order to do that first we have to create a Dockerfile. Create a directory and inside that directory create a Dockerfile.</p>

<pre><code>mkdir directory_name
cd directory_name
touch Dockerfile
</code></pre>

<p><em>Pause to teach you some Docker commands&hellip;</em></p>

<h2 id="docker-basic-commands">Docker basic commands</h2>

<p>Here is a list of a very basic Docker commands that you are going to use often:</p>

<pre><code>docker run &lt;image&gt;
</code></pre>

<p>This command will take any image, it will create a new container from the image and start that container.</p>

<hr />

<pre><code>docker start &lt;name|id&gt;
</code></pre>

<p>Start an existing container that is not running.</p>

<hr />

<pre><code>docker stop &lt;name|id&gt;
</code></pre>

<p>When a container is running you can use this command to stop the execution of that container.</p>

<hr />

<pre><code>docker ps [-a include stopped containers]
</code></pre>

<p>Gives you a list of all your running containers. If you use the flag <em>-a</em> it will show you all the stopped containers as well.</p>

<hr />

<pre><code>docker rm &lt;name|id&gt;
</code></pre>

<p>Remove / Delete a container</p>

<hr />

<p>Let&rsquo;s continue creating our image&hellip; We are creating a PostgreSQL 9.3 image in this tutorial.</p>

<p>Our Dockerfile will have to be like this:</p>

<script src="https://gist.github.com/andrealmar/bce56f7d8450990333703aa5c4ac8d61.js"></script>

<p>The Dockerfile is self-explanatory, it&rsquo;s well commented and if you have any questions please leave a comment below.</p>

<p>Now we have to <strong>build</strong> our image. Let&rsquo;s do this by typing the following command:</p>

<pre><code>docker build -t andrealmar/postgresql:9.3 .
</code></pre>

<p>You’ve specified our docker build command and used the -t flag to identify our new image as andrealmar/postgresql:9.3 and also specified the location of our Dockerfile using the . to indicate a Dockerfile in the current directory.</p>

<p>Services are built once and then tagged as postgresql:9.3. If you change a service&rsquo;s Dockerfile or the contents of its build directory, run <em>docker-compose build</em> to rebuild it.</p>

<p>The Output will be something like this:</p>

<pre><code>Sending build context to Docker daemon 19.97 kB
Step 1 : FROM ubuntu
 ---&gt; 97434d46f197
Step 2 : MAINTAINER Andre Almar &lt;andre@pydevv.com&gt;
 ---&gt; Using cache
 ---&gt; 70763ebda914
Step 3 : RUN apt-key adv --keyserver hkp://p80.pool.sks-keyservers.net:80 --recv-keys B97B0AFCAA1A47F044F244A07FCC7D46ACCC4CF8
 ---&gt; Using cache
 ---&gt; 9baa8c54442c
Step 4 : RUN echo &quot;deb http://apt.postgresql.org/pub/repos/apt/ precise-pgdg main&quot; &gt; /etc/apt/sources.list.d/pgdg.list
 ---&gt; Using cache
 ---&gt; e86e2f540ecb
Step 5 : RUN apt-get update &amp;&amp; apt-get install -y python-software-properties software-properties-common postgresql-9.3 postgresql-client-9.3 postgresql-contrib-9.3
 ---&gt; Using cache
 ---&gt; 69d82fd86acd
Step 6 : USER postgres
 ---&gt; Using cache
 ---&gt; cd2593bf4bbe
Step 7 : RUN /etc/init.d/postgresql start &amp;&amp;    psql --command &quot;CREATE USER docker WITH SUPERUSER PASSWORD 'docker';&quot; &amp;&amp;        createdb -O docker docker
 ---&gt; Using cache
 ---&gt; 9dbf59e35474
Step 8 : RUN echo &quot;host all  all    0.0.0.0/0  md5&quot; &gt;&gt; /etc/postgresql/9.3/main/pg_hba.conf
 ---&gt; Using cache
 ---&gt; 327f7dc70201
Step 9 : RUN echo &quot;listen_addresses='*'&quot; &gt;&gt; /etc/postgresql/9.3/main/postgresql.conf
 ---&gt; Using cache
 ---&gt; 1b146766f710
Step 10 : EXPOSE 5432
 ---&gt; Using cache
 ---&gt; e950c34ec810
Step 11 : VOLUME /etc/postgresql /var/log/postgresql /var/lib/postgresql
 ---&gt; Using cache
 ---&gt; 5d15ea251ef9
Step 12 : CMD /usr/lib/postgresql/9.3/bin/postgres -D /var/lib/postgresql/9.3/main -c config_file=/etc/postgresql/9.3/main/postgresql.conf
 ---&gt; Running in dc23742bbefd
 ---&gt; 5e614bcb798e
Removing intermediate container dc23742bbefd
Successfully built 5e614bcb798e
</code></pre>

<p>Our image was successfully built. Yay!!!</p>

<p>Now we have to run a container:</p>

<pre><code>docker run --rm -P --name pg_test andrealmar/postgresql:9.3
</code></pre>

<blockquote>
<p>Note: The &ndash;rm removes the container and its image when the container exits successfully.</p>
</blockquote>

<p>We&rsquo;ve built our image locally but we can push the image to the Docker Hub repository.</p>

<p>Go to <a href="https://hub.docker.com/">https://hub.docker.com/</a> and register an account. Now in your terminal type:</p>

<pre><code>docker login
</code></pre>

<p>Insert your credentials and you are ready to push your image to Docker Hub.</p>

<pre><code>docker push andrealmar/postgresql:9.3
</code></pre>

<p>Output will be something like this:</p>

<pre><code>The push refers to a repository [docker.io/andrealmar/postgresql]
25061686dd38: Pushed 
f3348af5962c: Pushed 
dad10331254a: Pushed 
601598d231fc: Pushed 
d0448568fb1f: Pushed 
7fedc9eff662: Pushed 
5f70bf18a086: Mounted from kartoza/postgis 
1b82ce694c3b: Mounted from library/ubuntu 
db6b2d84f3c6: Mounted from library/ubuntu 
05b940eef08d: Mounted from library/ubuntu 
9.3: digest: sha256:ba69f101c2b8b4536bab692b83b528bbb8c9bd7931d5740840c7417833b52300 size: 10429
</code></pre>

<p>If you go to your Docker Hub account you will see that your image is published.</p>

<p><img src="/images/docker_hub.png"></p>

<p>Ok, now that we&rsquo;ve built the PostgreSQL 9.3 image we have to run.</p>

<p>Please <strong>PAY ATTENTION</strong> here because it will free you from headaches. I&rsquo;ve lost a bunch of time trying to figure out this but with the help of <em>Sebastiaan van Stijn</em> - <a href="https://github.com/thaJeztah">https://github.com/thaJeztah</a> I was able to do this right.</p>

<p>The command below will run the container. When running on <strong>OS X</strong>, the docker daemon (and containers) are running in a Virtual Machine.</p>

<p>If you want to access the PostgreSQL database from your OS X machine, you need to <em>&ldquo;publish&rdquo;</em> the container&rsquo;s port, to make them publicly accessible.</p>

<pre><code>docker run -d -p 2345:5432 andrealmar/postgresql:9.3
</code></pre>

<p>Publishes port 5432 of the container on port 2345 on the host (the virtual machine in my case).</p>

<p>To access, use the IP-address of the virtual machine, which you can obtain via docker-machine:</p>

<pre><code>docker-machine ip
</code></pre>

<p>Output:</p>

<pre><code>192.168.99.100
</code></pre>

<p>You container is running so you are good to connect:</p>

<pre><code>psql -h 192.168.99.100 -p 2345 -U docker docker
</code></pre>

<pre><code>psql (9.5.1, server 9.3.12)
SSL connection (protocol: TLSv1.2, cipher: DHE-RSA-AES256-GCM-SHA384, bits: 256, compression: off)
Type &quot;help&quot; for help.

docker=# 
</code></pre>

<p>See you on Part 3.</p>

<p>Bye,</p>

<p>References:</p>

<p><a href="https://docs.docker.com/v1.5/compose/cli/">https://docs.docker.com/v1.5/compose/cli/</a><br />
<a href="https://docs.docker.com/engine/examples/postgresql_service/">https://docs.docker.com/engine/examples/postgresql_service/</a><br />
<a href="https://www.andreagrandi.it/2015/02/21/how-to-create-a-docker-image-for-postgresql-and-persist-data/">https://www.andreagrandi.it/2015/02/21/how-to-create-a-docker-image-for-postgresql-and-persist-data/</a><br />
<a href="http://www.mundodocker.com.br/">http://www.mundodocker.com.br/</a><br />
<a href="https://github.com/wsargent/docker-cheat-sheet">https://github.com/wsargent/docker-cheat-sheet</a></p>

  </div>
  <div id="disqus_thread"></div>
</div>


<script type="text/javascript">
var disqus_shortname = "andrealmar";
(function () {
    var s = document.createElement('script'); s.async = true;
    s.type = 'text/javascript';
    s.src = '//' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
}());
</script>



<script type="text/javascript">
    var disqus_shortname = "andrealmar";
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

<script src="http://andrealmar.com/js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-58773330-1', 'auto');
  ga('send', 'pageview');
</script>

</body>
</html>

